# Vulnerability Assessment Lab

## Overview

This project focuses on setting up a secure and isolated environment for testing and analyzing cybersecurity vulnerabilities. Using a Windows virtual machine (VM) on VirtualBox, we establish a controlled environment to conduct comprehensive vulnerability assessments and analysis. The project utilizes Nessus vulnerability scanner to identify potential security risks and weaknesses, followed by the development and implementation of effective remediation strategies to strengthen system resilience.

## Objectives

- Set up and configure a Windows virtual machine (VM) on VirtualBox to create a secure testing environment.
- Install and configure Nessus vulnerability scanner on the Windows VM for comprehensive vulnerability assessment.
- Conduct vulnerability scans using Nessus, including credential scans, to identify and assess security risks.
- Analyze vulnerabilities in the system by deliberately installing vulnerable software to simulate real-world scenarios.
- Develop and implement effective remediation strategies to minimize potential risks and strengthen system resilience.
### Skills Learned

- Setting up and configuring virtual machines for testing environments.
- Using Nessus vulnerability scanner for comprehensive vulnerability assessment.
- Analyzing vulnerability scan results and identifying security risks.
- Developing and implementing remediation strategies to address vulnerabilities.
- Strengthening system resilience through effective cybersecurity practices.

### Tools Used

- VirtualBox for creating secure and isolated testing environments.
- Nessus vulnerability scanner for comprehensive vulnerability assessment and analysis.

## Steps

### Setting Up Virtual Machines

#### Setting Up the Windows 10 Target Machine:

In this lab, we will configure a Windows 10 machine to serve as our target PC.

The objective is to simulate real-world scenarios by intentionally making the Windows 10 machine vulnerable. This will help us understand the risks associated with improper security configurations.

For guidance on setting up Virtual Machines, refer to this repository [Cybersecurity Labs](https://github.com/acibojbp/Cybersecurity-Labs-Setup).

Making the Windows 10 Machine Vulnerable:

- **Disable Windows Auto Updates:**
  
    ![](/images/windows-update.png)

    - Navigate to **Settings > Update & Security**.
    - Under Windows Update, select 'Pause updates' and set the duration long enough for the lab session to prevent automatic updates.

- **Uninstall Installed Updates:**
  
    ![](/images/uninstall-updates.png)
    - In the same **Update & Security** section, go to **Update history > Uninstall updates** and remove each installed update.

- **Turn Off Windows Firewall:**
  
    ![](/images/firewall.png)
    - Search for 'Firewall & Network Protection' in the Start menu.
    - Set the firewall state to 'Off' for each profile (Domain, Private, and Public).

Don't forget to restart your machine afterward.

Finally, let's ensure our vulnerable Windows machine and the Nessus machine are connected on the same network. In VirtualBox, I've selected the 'Internal Network' setting for the network adapter and assigned static IPs to both machines. This way, they can communicate with each other safely within their isolated network, without any interference from external sources or even the host system.

For more information on VirtualBox network adapters, refer to the [Virtual Networking documentation](https://www.virtualbox.org/manual/ch06.html).

If you're using Nessus on your host machine, make sure to choose the correct network adapter.

To ensure we're on the same network, give pinging between the machines a try. Remember, the default Windows firewall might block ICMP, so pinging from the vulnerable PC to your host might not work. But if you can ping the vulnerable Windows machine from your host, you're good to go.

I've set up Nessus on a separate virtual machine to keep things neatly virtualized. I went with Ubuntu for this part. Just make sure your IP settings are on point, and set a static IP if necessary.
Once the machines can communicate, we're ready to move forward.

### Installing and Configuring Nessus

For installing Tenable Nessus on Linux, you can check out the official guide: [Install Tenable Nessus on Linux (Tenable Nessus 10.7)](https://docs.tenable.com/nessus/Content/InstallNessusLinux.htm).

Since I'll be using a Linux virtual machine (Ubuntu 22.04 LTS) for this lab, that link will walk us through the installation process.

**First step:** Head over to [Tenable Nessus Essentials Vulnerability Scanner](https://www.tenable.com/products/nessus/nessus-essentials) to sign up and grab the free version of Nessus. Don't stress about the email; you can use [temp-mail.org](https://temp-mail.org/en/) to get a temporary business email. We'll need this later because Nessus will send us an activation key to that email.

**Next,** make sure you've downloaded the right installation file for your platform. In my case, it's `Nessus-10.7.1-ubuntu1404_amd64.deb`. Open your terminal, navigate to the Downloads folder, and run this command:

```
sudo dpkg -i Nessus-10.7.1-ubuntu1404_amd64.deb
```

**After the installation,** start the Nessus service with:

```
/bin/systemctl start nessusd.service
```

**To access Nessus,** open a browser and go to: https://localhost:8834/

You'll see a warning about potential risks due to it being a self-signed certificate. Just click 'Advanced,' then 'Accept Risk and Continue.'

This will take you to the Nessus login page.

**Step 1:** Click 'Continue.'

![](/images/nessus-00.png)

**Step 2:** Select 'Nessus Essentials' since we've already registered for it.

![](/images/nessus-01.png)

**Step 3:** In the next window, skip ahead since we've got the activation code in our email.

![](/images/nessus-02.png)

**Step 4:** Paste the activation code in the following window.

![](/images/nessus-03.png)

**Step 5:** Create your Nessus account.

![](/images/nessus-04.png)

**Step 6:** Wait for the download to finish.

![](/images/nessus-05.png)

After completing these steps, we're good to go!

After installing Nessus, you'll see a welcome message. You can dive right in by typing an IP address or subnet to start scanning immediately. But before we jump into scanning, I want to show you the different types of scans available to us.

![](/images/nessus-07.png)

Let's start by creating a new scan.
Here, you'll see the different scans that Nessus can perform on our target machine.

![](/images/nessus-08.png)

Feel free to explore the different scans on your own. Don't worry about breaking things—since this is all happening in a virtual machine, you can easily hit the reset button if needed.

![](/images/nessus-09.png)

For this lab, we'll stick with a normal scan. When you open it, just give it a name like "Windows," enter the IP address of our target machine, save the scan, and then hit "Launch."

![](/images/nessus-10.png)

### Nessus Scans

#### Initial Scan

Once the scan is completed, we can review the results. It detected 16 vulnerabilities. Clicking on the detected vulnerabilities will provide more details, including a description of the vulnerability and recommended solutions to remediate the issue.

![](/images/nessus-11.png)

![](/images/nessus-12.png)

![](/images/nessus-13.png)

#### Configuring Nessus for Credential Scan

Credential scanning with Nessus involves using login credentials to perform authenticated vulnerability assessments, enhancing scan accuracy by identifying hidden vulnerabilities and misconfigurations. This method allows Nessus to provide a comprehensive view of system security.

Click on the scan we just set up. In the top right corner, you'll see 'Configure.' From there, choose 'Credentials.' Since our target machine is Windows, select 'Windows.'

![](/images/nessus-14.png)

Next, pick the authentication method as 'Password.' There are other methods you can look into, but for our lab, let's go with 'Password.' Fill in the username and password.

To make sure our scan runs smoothly—and to tackle any permission errors—we need to tweak a few settings on our vulnerable Windows machine.

**Enable Remote Registry Service:**

![](/images/remote-registry.png)

- Search for 'Services' in the Start menu.
- Look for 'Remote Registry' and set its startup type to 'Automatic.'

Enabling the Remote Registry service allows Nessus to gather more detailed information from the Windows machine.

**Adjust User Account Control (UAC) Settings:**

![](/images/remote-registry.png)

- Search for 'User Account Control' in the Start menu.
- Slide the setting to the lowest level, 'Never Notify.'

Lowering the UAC setting helps to bypass some of the restrictions that might prevent Nessus from accessing certain system information.

**Modify Registry Editor:**

![](/images/reg-edit.png)

- Search for 'Reg Editor' in the Start menu to open the Registry Editor.
- Navigate to: `HKEY_LOCAL_MACHINE > Software > Microsoft > Windows > CurrentVersion > Policies > System`
- Right-click on the empty space, choose 'New' > 'DWORD (32-bit) Value.'
- Name it 'LocalAccountTokenFilterPolicy.'
- Double-click on it and set the value to '1.'

This registry tweak allows Nessus to access remote registry information, enhancing the scan's effectiveness.

After making these changes, restart your system and kick off another scan with Nessus.

![](/images/nessus-15.png)

We see a lot of vulnerabilities and we can click each one to view what they are about and the related CVE.
You can learn more about them by clicking on the provided links.

![](/images/nessus-16.png)

![](/images/nessus-17.png)

### Installing Vulnerable Software

Next, let's install some outdated software on our Windows VM.

Since our VM is on an internal network without internet access, we need to switch the network adapter to NAT for internet connectivity. You can do this by clicking on `Devices > Network > Network Settings` and changing it to NAT.

For the software downloads, you could just Google the old versions.

Let's grab an old version of Google Chrome as an example.

![](/images/chrome.png)

>Older versions of Chrome can have issues with how they handle and store passwords. This could let attackers get into your stored passwords or take advantage of weak encryption methods used to protect them.

Another one to look out for is an old version of the Minecraft server, which has that pesky Log4j vulnerability.

![](/images/minecraft.png)
  
>Log4j was exploited through a vulnerability known as Log4Shell or CVE-2021-44228. This vulnerability allowed attackers to execute arbitrary code remotely. Attackers were able to craft malicious requests that, when >processed by a vulnerable Log4j instance, could lead to the execution of arbitrary code on the target system. This exploit posed a significant security risk because it could be used to take control of affected systems, >potentially leading to data theft, system compromise, or other malicious activities.

Download an older version of the Minecraft server. To extract the downloaded Minecraft server, you'll need 7-Zip. Make sure to download an older version of that too.

![](/images/7zip.png)

Now that everything's downloaded, switch the network adapter back to the internal network and double-check it's using the same IP as before.

Install that older version of Chrome you downloaded. Since we're on an internal network without internet, there's no need to stress about it auto-updating.

![](/images/chrome-version.png)

To make sure those auto-updates are stopped:

![](/images/chrome-update.png)

- Search for 'System Configuration' in the Start menu.
- Navigate to the 'Services' tab.
- Locate 'Google Update Service'.
- Uncheck the box, hit apply, and then restart your virtual machine.

Use 7zip to extract the old version of Minecraft. No need for any extra steps, just unzip it.

Now, fire up another scan in Nessus.

![](/images/nessus-18.png)

Keep in mind, if you downloaded a different old version than I did, your vulnerability results might look different from what I've shown here.

![](/images/nessus-19.png)
   
![](/images/nessus-20.png)

### Reporting

A comprehensive report can be generated to present to the development team. To initiate this, navigate to 'Report' at the top right corner and select 'Generate Report'. The resulting report will provide a detailed overview of all identified vulnerabilities.

![](/images/nessus-21.png)

If you don't see the PDF option, it's likely you don't have Java installed, which is required for generating the report. To resolve this:

1. **Check Java Installation**:
    Open the terminal.
    - Type `java -version` and press Enter.
    - If Java is not installed, you will receive a message indicating so.

2. **Install Java**:
	- In the terminal, enter the following command:

```
sudo apt update sudo apt install default-jre
```

4. **Restart Nessus**:
    - Once Java is installed, restart Nessus to ensure the changes take effect.
    - Use the appropriate command to restart Nessus, typically something like:

```
sudo systemctl restart nessusd
```

After following these steps, the PDF report generation option should be available in Nessus.

![](/images/nessus-22.png)

### Remediations

To remediate the vulnerabilities, follow these steps:

1. **Enable Windows Auto Update**:
    
    - Go to **Settings**.
    - Navigate to **Update & Security**.
    - Click on **Windows Update** and enable automatic updates.
2. **Activate the Firewall**:
    
    - Search for **Windows Defender Firewall** in the Start menu.
    - Ensure the firewall is turned on for all network types: Domain, Private, and Public.
3. **Reverse Previous Changes**:
    
    - Re-enable any services or settings that were disabled.
    - Restore any files or configurations that were altered.
4. **Delete or Update Vulnerable Files**:
    
    - Identify and delete any files known to pose security risks.
    - Update vulnerable applications to their latest versions.

After completing the remediation steps:

- **Restart the Machine**:
    
    - Restart your computer to apply all the changes.

- **Run a Final Nessus Scan**:
    
    - Launch Nessus and initiate a new scan on your machine.

Upon completion of the final scan, you should see:

![](/images/nessus-23.png)

The system should now be secure with no critical vulnerabilities detected. Only informational vulnerabilities remain. If any issues persist, do some research and try to remediate them.

Congratulations! You've successfully completed the lab and gained valuable experience in vulnerability management. This hands-on exercise has equipped you with practical skills to identify, assess, and remediate security vulnerabilities in a controlled environment. Understanding these processes is crucial in real-world cybersecurity scenarios, allowing you to better protect systems and data against potential threats. Keep exploring and practicing to further enhance your expertise in the field of cybersecurity.
